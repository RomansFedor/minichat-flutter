# üìö –¢–µ–æ—Ä—ñ—è Firebase —Ç–∞ –≤—ñ–¥–∂–µ—Ç–∏ –¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏

## üìã –ó–ú–Ü–°–¢ 
1. [Firebase - –∑–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è](#firebase-–∑–∞–≥–∞–ª—å–Ω–∞-—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è)
2. [Firebase —Å–µ—Ä–≤—ñ—Å–∏ –≤ –ø—Ä–æ—î–∫—Ç—ñ](#firebase-—Å–µ—Ä–≤—ñ—Å–∏-–≤-–ø—Ä–æ—î–∫—Ç—ñ)
3. [Cloud Firestore - –±–∞–∑–∞ –¥–∞–Ω–∏—Ö](#cloud-firestore)
4. [Firebase Authentication](#firebase-authentication)
5. [Firebase Analytics —Ç–∞ Crashlytics](#firebase-analytics-—Ç–∞-crashlytics)
6. [–í—ñ–¥–∂–µ—Ç–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ Firebase](#–≤—ñ–¥–∂–µ—Ç–∏-–¥–ª—è-—Ä–æ–±–æ—Ç–∏-–∑-firebase)
7. [–û—Å–Ω–æ–≤–Ω—ñ Flutter –≤—ñ–¥–∂–µ—Ç–∏ –≤ –ø—Ä–æ—î–∫—Ç—ñ](#–æ—Å–Ω–æ–≤–Ω—ñ-flutter-–≤—ñ–¥–∂–µ—Ç–∏)
8. [–ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è](#–ø—Ä–∞–∫—Ç–∏—á–Ω—ñ-–ø—Ä–∏–∫–ª–∞–¥–∏)

---

## üî• FIREBASE - –ó–ê–ì–ê–õ–¨–ù–ê –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø

### –©–æ —Ç–∞–∫–µ Firebase?

**Firebase** - —Ü–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤—ñ–¥ Google –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ –º–æ–±—ñ–ª—å–Ω–∏—Ö —Ç–∞ –≤–µ–±-–¥–æ–¥–∞—Ç–∫—ñ–≤, —è–∫–∞ –Ω–∞–¥–∞—î –Ω–∞–±—ñ—Ä —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Ç–∞ —Å–µ—Ä–≤—ñ—Å—ñ–≤ –¥–ª—è backend-—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –ø–∏—Å–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä–Ω–∏–π –∫–æ–¥.

### –û—Å–Ω–æ–≤–Ω—ñ –ø–µ—Ä–µ–≤–∞–≥–∏ Firebase:

1. **Backend as a Service (BaaS)** - –≥–æ—Ç–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏ –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä—ñ–≤
2. **Real-time —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –º—ñ–∂ –∫–ª—ñ—î–Ω—Ç–∞–º–∏
3. **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
4. **–ë–µ–∑–ø–µ–∫–∞** - –≤–±—É–¥–æ–≤–∞–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–ø–µ–∫–∏ —Ç–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
5. **–ö—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ñ—Å—Ç—å** - –ø—Ä–∞—Ü—é—î –Ω–∞ Android, iOS, Web, Desktop

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ Firebase –≤ –ø—Ä–æ—î–∫—Ç—ñ:

```
Flutter App
    ‚îÇ
    ‚îú‚îÄ‚îÄ Firebase Core (—ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è)
    ‚îú‚îÄ‚îÄ Firebase Auth (–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è)
    ‚îú‚îÄ‚îÄ Cloud Firestore (–±–∞–∑–∞ –¥–∞–Ω–∏—Ö)
    ‚îú‚îÄ‚îÄ Firebase Analytics (–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞)
    ‚îî‚îÄ‚îÄ Firebase Crashlytics (–∑–≤—ñ—Ç–∏ –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏)
```

---

## üîß FIREBASE –°–ï–†–í–Ü–°–ò –í –ü–†–û–Ñ–ö–¢–Ü

### 1. Firebase Core (`firebase_core`)

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ë–∞–∑–æ–≤–∏–π –ø–∞–∫–µ—Ç –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Firebase –≤ –¥–æ–¥–∞—Ç–∫—É.

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –ø—Ä–æ—î–∫—Ç—ñ:**
```dart
// lib/main.dart
await Firebase.initializeApp(
  options: DefaultFirebaseOptions.currentPlatform,
);
```

**–©–æ —Ä–æ–±–∏—Ç—å:**
- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î Firebase –¥–ª—è –≤—Å—ñ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º (Android, iOS, Web)
- –ù–∞–ª–∞—à—Ç–æ–≤—É—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase –ø—Ä–æ–µ–∫—Ç—É
- –ú–∞—î –±—É—Ç–∏ –≤–∏–∫–ª–∏–∫–∞–Ω–∏–π –ø–µ—Ä–µ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —ñ–Ω—à–∏—Ö Firebase —Å–µ—Ä–≤—ñ—Å—ñ–≤

**–í–∞–∂–ª–∏–≤–æ:**
- –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ –¥–æ–¥–∞—Ç–∫—É
- `WidgetsFlutterBinding.ensureInitialized()` –º–∞—î –±—É—Ç–∏ –≤–∏–∫–ª–∏–∫–∞–Ω–∏–π –ø–µ—Ä–µ–¥ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é

---

### 2. Firebase Authentication (`firebase_auth`)

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –°–µ—Ä–≤—ñ—Å –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–≤—Ö—ñ–¥, —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è, –≤–∏—Ö—ñ–¥).

**–û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**
- Email/Password –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
- –ê–Ω–æ–Ω—ñ–º–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
- –°–æ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ä–µ–∂—ñ (Google, Facebook, —Ç–æ—â–æ)
- –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å–µ—Å—ñ—è–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –ø—Ä–æ—î–∫—Ç—ñ:**

```dart
// –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
final user = FirebaseAuth.instance.currentUser;

// –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
await FirebaseAuth.instance.createUserWithEmailAndPassword(
  email: email,
  password: password,
);

// –í—Ö—ñ–¥
await FirebaseAuth.instance.signInWithEmailAndPassword(
  email: email,
  password: password,
);

// –í–∏—Ö—ñ–¥
await FirebaseAuth.instance.signOut();
```

**–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫:**
```dart
try {
  await AuthRepository().signIn(email: email, password: password);
} on FirebaseAuthException catch (e) {
  // –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
  print(e.message);
}
```

**–û—Å–Ω–æ–≤–Ω—ñ —Ç–∏–ø–∏ –ø–æ–º–∏–ª–æ–∫:**
- `user-not-found` - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π
- `wrong-password` - –Ω–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å
- `email-already-in-use` - email –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è
- `weak-password` - —Å–ª–∞–±–∫–∏–π –ø–∞—Ä–æ–ª—å

**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ User:**
- `uid` - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `email` - email –∞–¥—Ä–µ—Å–∞
- `displayName` - –≤—ñ–¥–æ–±—Ä–∞–∂—É–≤–∞–Ω–µ —ñ–º'—è
- `photoURL` - URL —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é

---

### 3. Cloud Firestore (`cloud_firestore`)

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** NoSQL –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö:**
```
Firestore
  ‚îî‚îÄ‚îÄ –ö–æ–ª–µ–∫—Ü—ñ—ó (Collections)
      ‚îî‚îÄ‚îÄ –î–æ–∫—É–º–µ–Ω—Ç–∏ (Documents)
          ‚îú‚îÄ‚îÄ –ü–æ–ª—è (Fields)
          ‚îî‚îÄ‚îÄ –ü—ñ–¥–∫–æ–ª–µ–∫—Ü—ñ—ó (Subcollections)
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ –ø—Ä–æ—î–∫—Ç—ñ:**
```
chat_rooms (–∫–æ–ª–µ–∫—Ü—ñ—è)
  ‚îî‚îÄ‚îÄ {chatId} (–¥–æ–∫—É–º–µ–Ω—Ç)
      ‚îú‚îÄ‚îÄ name: "–ù–∞–∑–≤–∞ —á–∞—Ç—É"
      ‚îú‚îÄ‚îÄ lastMessage: {...}
      ‚îú‚îÄ‚îÄ lastMessageTime: Timestamp
      ‚îî‚îÄ‚îÄ messages (–ø—ñ–¥–∫–æ–ª–µ–∫—Ü—ñ—è)
          ‚îî‚îÄ‚îÄ {messageId} (–¥–æ–∫—É–º–µ–Ω—Ç)
              ‚îú‚îÄ‚îÄ text: "–¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"
              ‚îú‚îÄ‚îÄ sender: "email@example.com"
              ‚îú‚îÄ‚îÄ senderId: "userId"
              ‚îú‚îÄ‚îÄ timestamp: Timestamp
              ‚îî‚îÄ‚îÄ reactions: {...}

saved_messages (–∫–æ–ª–µ–∫—Ü—ñ—è)
  ‚îî‚îÄ‚îÄ {savedId} (–¥–æ–∫—É–º–µ–Ω—Ç)
      ‚îú‚îÄ‚îÄ userId: "userId"
      ‚îú‚îÄ‚îÄ messageId: "messageId"
      ‚îú‚îÄ‚îÄ text: "–¢–µ–∫—Å—Ç"
      ‚îî‚îÄ‚îÄ savedAt: Timestamp
```

**–û—Å–Ω–æ–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó:**

**1. –ß–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–µ):**
```dart
// –û—Ç—Ä–∏–º–∞—Ç–∏ –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç
final doc = await FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc(chatId)
    .get();

if (doc.exists) {
  final data = doc.data(); // Map<String, dynamic>
}
```

**2. –ß–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö (real-time):**
```dart
// Stream –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
Stream<DocumentSnapshot> stream = FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc(chatId)
    .snapshots();

// –ê–±–æ –¥–ª—è –∫–æ–ª–µ–∫—Ü—ñ—ó
Stream<QuerySnapshot> stream = FirebaseFirestore.instance
    .collection('chat_rooms')
    .snapshots();
```

**3. –î–æ–¥–∞–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö:**
```dart
// –î–æ–¥–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º ID
await FirebaseFirestore.instance
    .collection('chat_rooms')
    .add({
      'name': '–ù–æ–≤–∏–π —á–∞—Ç',
      'createdAt': FieldValue.serverTimestamp(),
    });

// –î–æ–¥–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º ID
await FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc('chatId123')
    .set({
      'name': '–ù–æ–≤–∏–π —á–∞—Ç',
      'createdAt': FieldValue.serverTimestamp(),
    });
```

**4. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:**
```dart
await FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc(chatId)
    .update({
      'lastMessage': {'text': '–ù–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è'},
      'lastMessageTime': FieldValue.serverTimestamp(),
    });
```

**5. –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:**
```dart
await FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc(chatId)
    .delete();
```

**6. –ó–∞–ø–∏—Ç–∏ –∑ —É–º–æ–≤–∞–º–∏:**
```dart
// –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
FirebaseFirestore.instance
    .collection('messages')
    .orderBy('timestamp', descending: true)
    .limit(50)
    .snapshots();

// –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
FirebaseFirestore.instance
    .collection('chat_rooms')
    .where('lastMessageTime', isGreaterThan: yesterday)
    .snapshots();
```

**–°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è:**
- `FieldValue.serverTimestamp()` - —Å–µ—Ä–≤–µ—Ä–Ω–∏–π —á–∞—Å (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è Firebase)
- `FieldValue.delete()` - –≤–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–ª–µ
- `FieldValue.arrayUnion([...])` - –¥–æ–¥–∞—Ç–∏ –¥–æ –º–∞—Å–∏–≤—É
- `FieldValue.arrayRemove([...])` - –≤–∏–¥–∞–ª–∏—Ç–∏ –∑ –º–∞—Å–∏–≤—É

**–¢–∏–ø–∏ –¥–∞–Ω–∏—Ö:**
- String, Number, Boolean
- Map (–æ–±'—î–∫—Ç)
- List (–º–∞—Å–∏–≤)
- Timestamp (–¥–∞—Ç–∞/—á–∞—Å)
- GeoPoint (–≥–µ–æ–ª–æ–∫–∞—Ü—ñ—è)
- Reference (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —ñ–Ω—à–∏–π –¥–æ–∫—É–º–µ–Ω—Ç)

---

### 4. Firebase Analytics (`firebase_analytics`)

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ó–±—ñ—Ä –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –ø—Ä–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É.

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –ø—Ä–æ—î–∫—Ç—ñ:**
```dart
// –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π
FirebaseAnalytics.instance.logEvent(name: 'login');
FirebaseAnalytics.instance.logEvent(name: 'register');

// –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
FirebaseAnalytics.instance.logEvent(
  name: 'message_sent',
  parameters: {
    'chat_id': chatId,
    'message_length': text.length,
  },
);
```

**–©–æ –≤—ñ–¥—Å—Ç–µ–∂—É—î—Ç—å—Å—è:**
- –ü–æ–¥—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (login, register, message_sent)
- –ï–∫—Ä–∞–Ω–∏, —è–∫—ñ –≤—ñ–¥–≤—ñ–¥—É—é—Ç—å—Å—è
- –ü–æ–º–∏–ª–∫–∏ —Ç–∞ –≤–∏–Ω—è—Ç–∫–∏
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏

---

### 5. Firebase Crashlytics (`firebase_crashlytics`)

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ó–±—ñ—Ä —Ç–∞ –∞–Ω–∞–ª—ñ–∑ –∑–≤—ñ—Ç—ñ–≤ –ø—Ä–æ –∑–±–æ—ó —Ç–∞ –ø–æ–º–∏–ª–∫–∏ –¥–æ–¥–∞—Ç–∫—É.

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –ø—Ä–æ—î–∫—Ç—ñ:**
```dart
// –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫
FlutterError.onError = FirebaseCrashlytics.instance.recordFlutterFatalError;

// –û–±—Ä–æ–±–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫
runZonedGuarded<Future<void>>(
  () async => runApp(const MiniChatApp()),
  (error, stack) => FirebaseCrashlytics.instance.recordError(
    error, 
    stack, 
    fatal: true,
  ),
);

// –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π
await FirebaseCrashlytics.instance.log('Manual test crash');

// –¢–µ—Å—Ç–æ–≤–∏–π –∑–±—ñ–π
FirebaseCrashlytics.instance.crash();
```

**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–∏—Ä–∞—î –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∑–±–æ—ó
- –ù–∞–¥–∞—î stack trace –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –ì—Ä—É–ø—É—î –ø–æ–¥—ñ–±–Ω—ñ –ø–æ–º–∏–ª–∫–∏
- –ù–∞–¥—Å–∏–ª–∞—î –∑–≤—ñ—Ç–∏ –≤ Firebase Console

---

## üé® –í–Ü–î–ñ–ï–¢–ò –î–õ–Ø –†–û–ë–û–¢–ò –ó FIREBASE

### 1. StreamBuilder

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –í—ñ–¥–∂–µ—Ç, —è–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î UI –ø—Ä–∏ –∑–º—ñ–Ω—ñ –¥–∞–Ω–∏—Ö —É Stream (–ø–æ—Ç–æ–∫—É –¥–∞–Ω–∏—Ö).

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**
```dart
StreamBuilder<QuerySnapshot>(
  stream: FirebaseFirestore.instance
      .collection('chat_rooms')
      .snapshots(),
  builder: (context, snapshot) {
    // snapshot –º–∞—î —Å—Ç–∞–Ω–∏: connectionState, hasData, hasError, data
    if (snapshot.connectionState == ConnectionState.waiting) {
      return CircularProgressIndicator();
    }
    
    if (snapshot.hasError) {
      return Text('–ü–æ–º–∏–ª–∫–∞: ${snapshot.error}');
    }
    
    if (!snapshot.hasData || snapshot.data!.docs.isEmpty) {
      return Text('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö');
    }
    
    final docs = snapshot.data!.docs;
    return ListView.builder(
      itemCount: docs.length,
      itemBuilder: (context, index) {
        final doc = docs[index];
        final data = doc.data() as Map<String, dynamic>;
        return ListTile(title: Text(data['name']));
      },
    );
  },
)
```

**–°—Ç–∞–Ω–∏ StreamBuilder:**
- `ConnectionState.waiting` - –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- `ConnectionState.active` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- `ConnectionState.done` - –ø–æ—Ç—ñ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –ø—Ä–æ—î–∫—Ç—ñ:**
- –°–ø–∏—Å–æ–∫ —á–∞—Ç—ñ–≤ (`chats_screen.dart`)
- –°–ø–∏—Å–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (`chat_room_screen.dart`)
- –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (`saved_messages_screen.dart`)

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI –ø—Ä–∏ –∑–º—ñ–Ω—ñ –¥–∞–Ω–∏—Ö
- –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Ä—É—á–Ω—É –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ
- Real-time —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –º—ñ–∂ –∫–ª—ñ—î–Ω—Ç–∞–º–∏

---

### 2. QuerySnapshot

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Ç—É –¥–æ –∫–æ–ª–µ–∫—Ü—ñ—ó Firestore, —â–æ –º—ñ—Å—Ç–∏—Ç—å –º–∞—Å–∏–≤ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤.

**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**
- `docs` - —Å–ø–∏—Å–æ–∫ DocumentSnapshot
- `size` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- `metadata` - –º–µ—Ç–∞–¥–∞–Ω—ñ –∑–∞–ø–∏—Ç—É

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```dart
StreamBuilder<QuerySnapshot>(
  stream: FirebaseFirestore.instance
      .collection('chat_rooms')
      .snapshots(),
  builder: (context, snapshot) {
    if (!snapshot.hasData) return SizedBox();
    
    final querySnapshot = snapshot.data!;
    final docs = querySnapshot.docs; // List<QueryDocumentSnapshot>
    
    return ListView.builder(
      itemCount: querySnapshot.size,
      itemBuilder: (context, index) {
        final doc = docs[index];
        final data = doc.data() as Map<String, dynamic>;
        return Text(data['name']);
      },
    );
  },
)
```

---

### 3. DocumentSnapshot

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –†–µ–∑—É–ª—å—Ç–∞—Ç —á–∏—Ç–∞–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∑ Firestore.

**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**
- `id` - ID –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `data()` - –¥–∞–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (Map<String, dynamic>?)
- `exists` - —á–∏ —ñ—Å–Ω—É—î –¥–æ–∫—É–º–µ–Ω—Ç
- `reference` - –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```dart
StreamBuilder<DocumentSnapshot>(
  stream: FirebaseFirestore.instance
      .collection('chat_rooms')
      .doc(chatId)
      .snapshots(),
  builder: (context, snapshot) {
    if (!snapshot.hasData || !snapshot.data!.exists) {
      return Text('–î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
    }
    
    final doc = snapshot.data!;
    final data = doc.data() as Map<String, dynamic>?;
    
    if (data == null) return SizedBox();
    
    return Text(data['name'] ?? '–ë–µ–∑ –Ω–∞–∑–≤–∏');
  },
)
```

---

## üéØ –û–°–ù–û–í–ù–Ü FLUTTER –í–Ü–î–ñ–ï–¢–ò –í –ü–†–û–Ñ–ö–¢–Ü

### Layout –≤—ñ–¥–∂–µ—Ç–∏

#### 1. Scaffold
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ë–∞–∑–æ–≤–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è Material Design –µ–∫—Ä–∞–Ω—ñ–≤.

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```dart
Scaffold(
  appBar: AppBar(title: Text('–ó–∞–≥–æ–ª–æ–≤–æ–∫')),
  body: Center(child: Text('–ö–æ–Ω—Ç–µ–Ω—Ç')),
  bottomNavigationBar: NavigationBar(...),
)
```

#### 2. Column / Row
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –†–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –≤—ñ–¥–∂–µ—Ç—ñ–≤ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ (Column) –∞–±–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ (Row).

```dart
Column(
  children: [
    Text('–ï–ª–µ–º–µ–Ω—Ç 1'),
    Text('–ï–ª–µ–º–µ–Ω—Ç 2'),
  ],
)

Row(
  children: [
    Icon(Icons.star),
    Text('–†–µ–π—Ç–∏–Ω–≥'),
  ],
)
```

#### 3. Container
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é —Å—Ç–∏–ª—ñ–∑–∞—Ü—ñ—ó.

```dart
Container(
  padding: EdgeInsets.all(16),
  decoration: BoxDecoration(
    color: Colors.blue,
    borderRadius: BorderRadius.circular(12),
    boxShadow: [...],
  ),
  child: Text('–¢–µ–∫—Å—Ç'),
)
```

#### 4. Expanded / Flexible
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ó–∞–π–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –≤ Row/Column.

```dart
Row(
  children: [
    Icon(Icons.star),
    Expanded(
      child: Text('–¢–µ–∫—Å—Ç –∑–∞–π–º–∞—î –≤–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä'),
    ),
    Icon(Icons.favorite),
  ],
)
```

### –°–ø–∏—Å–∫–∏ —Ç–∞ –¥–∞–Ω—ñ

#### 5. ListView.builder
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ï—Ñ–µ–∫—Ç–∏–≤–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—ñ–≤ (—Å—Ç–≤–æ—Ä—é—î –µ–ª–µ–º–µ–Ω—Ç–∏ "–Ω–∞ –ª—å–æ—Ç—É").

```dart
ListView.builder(
  itemCount: items.length,
  itemBuilder: (context, index) {
    return ListTile(title: Text(items[index]));
  },
)
```

#### 6. Card
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** Material Design –∫–∞—Ä—Ç–∫–∞ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.

```dart
Card(
  elevation: 2,
  child: ListTile(
    leading: Icon(Icons.chat),
    title: Text('–ù–∞–∑–≤–∞ —á–∞—Ç—É'),
    subtitle: Text('–û—Å—Ç–∞–Ω–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è'),
  ),
)
```

### –§–æ—Ä–º–∏ —Ç–∞ –≤–≤–µ–¥–µ–Ω–Ω—è

#### 7. TextField / TextFormField
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ü–æ–ª–µ –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É.

```dart
TextField(
  controller: _controller,
  decoration: InputDecoration(
    hintText: '–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç',
    border: OutlineInputBorder(),
  ),
  onSubmitted: (value) {
    // –û–±—Ä–æ–±–∫–∞ –≤–≤–µ–¥–µ–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É
  },
)
```

#### 8. Form
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–æ–ª—ñ–≤ —Ñ–æ—Ä–º–∏ –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é.

```dart
Form(
  key: _formKey,
  child: Column(
    children: [
      TextFormField(
        validator: (value) {
          if (value == null || value.isEmpty) {
            return '–ü–æ–ª–µ –æ–±–æ–≤\'—è–∑–∫–æ–≤–µ';
          }
          return null;
        },
      ),
      ElevatedButton(
        onPressed: () {
          if (_formKey.currentState!.validate()) {
            // –§–æ—Ä–º–∞ –≤–∞–ª—ñ–¥–Ω–∞
          }
        },
        child: Text('–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏'),
      ),
    ],
  ),
)
```

### –î—ñ–∞–ª–æ–≥–∏ —Ç–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è

#### 9. AlertDialog
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ú–æ–¥–∞–ª—å–Ω–µ –¥—ñ–∞–ª–æ–≥–æ–≤–µ –≤—ñ–∫–Ω–æ.

```dart
showDialog(
  context: context,
  builder: (context) => AlertDialog(
    title: Text('–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è'),
    content: Text('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ?'),
    actions: [
      TextButton(
        onPressed: () => Navigator.pop(context),
        child: Text('–°–∫–∞—Å—É–≤–∞—Ç–∏'),
      ),
      TextButton(
        onPressed: () => Navigator.pop(context, true),
        child: Text('–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏'),
      ),
    ],
  ),
);
```

#### 10. SnackBar
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –¢–∏–º—á–∞—Å–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–Ω–∏–∑—É –µ–∫—Ä–∞–Ω—É.

```dart
ScaffoldMessenger.of(context).showSnackBar(
  SnackBar(
    content: Text('–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ'),
    duration: Duration(seconds: 2),
    behavior: SnackBarBehavior.floating,
  ),
);
```

### –ö–Ω–æ–ø–∫–∏

#### 11. ElevatedButton
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ö–Ω–æ–ø–∫–∞ –∑ –µ—Ñ–µ–∫—Ç–æ–º –ø—ñ–¥–Ω—è—Ç—Ç—è.

```dart
ElevatedButton(
  onPressed: () {
    // –î—ñ—è
  },
  child: Text('–ù–∞—Ç–∏—Å–Ω—É—Ç–∏'),
)
```

#### 12. IconButton
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ö–Ω–æ–ø–∫–∞ –∑ —ñ–∫–æ–Ω–∫–æ—é.

```dart
IconButton(
  icon: Icon(Icons.send),
  onPressed: () {
    // –î—ñ—è
  },
)
```

### –Ü–Ω—à—ñ –∫–æ—Ä–∏—Å–Ω—ñ –≤—ñ–¥–∂–µ—Ç–∏

#### 13. SafeArea
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –î–æ–¥–∞—î –≤—ñ–¥—Å—Ç—É–ø–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (notch, status bar).

```dart
SafeArea(
  child: Column(
    children: [...],
  ),
)
```

#### 14. Padding / SizedBox
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤—ñ–¥—Å—Ç—É–ø—ñ–≤.

```dart
Padding(
  padding: EdgeInsets.all(16),
  child: Text('–¢–µ–∫—Å—Ç'),
)

SizedBox(height: 20) // –ü—Ä–æ—Å—Ç—ñ—Ä –º—ñ–∂ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏
```

#### 15. CircularProgressIndicator
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.

```dart
CircularProgressIndicator()
```

---

## üí° –ü–†–ê–ö–¢–ò–ß–ù–Ü –ü–†–ò–ö–õ–ê–î–ò –í–ò–ö–û–†–ò–°–¢–ê–ù–ù–Ø

### –ü—Ä–∏–∫–ª–∞–¥ 1: –°–ø–∏—Å–æ–∫ —á–∞—Ç—ñ–≤ –∑ real-time –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º

```dart
StreamBuilder<QuerySnapshot>(
  stream: FirebaseFirestore.instance
      .collection('chat_rooms')
      .orderBy('lastMessageTime', descending: true)
      .snapshots(),
  builder: (context, snapshot) {
    if (snapshot.connectionState == ConnectionState.waiting) {
      return Center(child: CircularProgressIndicator());
    }
    
    if (snapshot.hasError) {
      return Center(child: Text('–ü–æ–º–∏–ª–∫–∞: ${snapshot.error}'));
    }
    
    if (!snapshot.hasData || snapshot.data!.docs.isEmpty) {
      return Center(child: Text('–ù–µ–º–∞—î —á–∞—Ç—ñ–≤'));
    }
    
    final chats = snapshot.data!.docs;
    return ListView.builder(
      itemCount: chats.length,
      itemBuilder: (context, index) {
        final chat = chats[index];
        final data = chat.data() as Map<String, dynamic>;
        return Card(
          child: ListTile(
            title: Text(data['name'] ?? '–ë–µ–∑ –Ω–∞–∑–≤–∏'),
            subtitle: Text(data['lastMessage']?['text'] ?? ''),
            onTap: () {
              Navigator.push(
                context,
                MaterialPageRoute(
                  builder: (_) => ChatRoomScreen(
                    chatId: chat.id,
                    chatName: data['name'],
                  ),
                ),
              );
            },
          ),
        );
      },
    );
  },
)
```

### –ü—Ä–∏–∫–ª–∞–¥ 2: –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

```dart
Future<void> _sendMessage() async {
  final text = _controller.text.trim();
  if (text.isEmpty) return;
  
  final user = FirebaseAuth.instance.currentUser;
  if (user == null) return;
  
  try {
    // –î–æ–¥–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    await FirebaseFirestore.instance
        .collection('chat_rooms')
        .doc(chatId)
        .collection('messages')
        .add({
      'text': text,
      'sender': user.email,
      'senderId': user.uid,
      'timestamp': FieldValue.serverTimestamp(),
      'reactions': {},
    });
    
    // –û–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –æ—Å—Ç–∞–Ω–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    await FirebaseFirestore.instance
        .collection('chat_rooms')
        .doc(chatId)
        .update({
      'lastMessage': {
        'text': text,
        'sender': user.email,
      },
      'lastMessageTime': FieldValue.serverTimestamp(),
    });
    
    _controller.clear();
  } catch (e) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('–ü–æ–º–∏–ª–∫–∞: $e')),
    );
  }
}
```

### –ü—Ä–∏–∫–ª–∞–¥ 3: –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

```dart
Future<void> _signIn() async {
  try {
    final credential = await FirebaseAuth.instance
        .signInWithEmailAndPassword(
          email: _emailController.text.trim(),
          password: _passwordController.text.trim(),
        );
    
    // –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ—ó
    FirebaseAnalytics.instance.logEvent(name: 'login');
    
    // –ü–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ –µ–∫—Ä–∞–Ω —á–∞—Ç—ñ–≤
    Navigator.pushReplacement(
      context,
      MaterialPageRoute(builder: (_) => ChatsScreen()),
    );
  } on FirebaseAuthException catch (e) {
    String message = '–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó';
    switch (e.code) {
      case 'user-not-found':
        message = '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π';
        break;
      case 'wrong-password':
        message = '–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å';
        break;
      case 'invalid-email':
        message = '–ù–µ–≤—ñ—Ä–Ω–∏–π email';
        break;
    }
    
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text(message)),
    );
  }
}
```

### –ü—Ä–∏–∫–ª–∞–¥ 4: –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ä–µ–∞–∫—Ü—ñ—ó –¥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

```dart
Future<void> _addReaction(String messageId, String emoji) async {
  final user = FirebaseAuth.instance.currentUser;
  if (user == null) return;
  
  final messageRef = FirebaseFirestore.instance
      .collection('chat_rooms')
      .doc(chatId)
      .collection('messages')
      .doc(messageId);
  
  final messageDoc = await messageRef.get();
  if (!messageDoc.exists) return;
  
  final data = messageDoc.data() as Map<String, dynamic>;
  final reactions = Map<String, dynamic>.from(data['reactions'] ?? {});
  final emojiReactions = List<String>.from(reactions[emoji] ?? []);
  
  if (emojiReactions.contains(user.uid)) {
    // –í–∏–¥–∞–ª–∏—Ç–∏ —Ä–µ–∞–∫—Ü—ñ—é
    emojiReactions.remove(user.uid);
    if (emojiReactions.isEmpty) {
      reactions.remove(emoji);
    } else {
      reactions[emoji] = emojiReactions;
    }
  } else {
    // –î–æ–¥–∞—Ç–∏ —Ä–µ–∞–∫—Ü—ñ—é
    emojiReactions.add(user.uid);
    reactions[emoji] = emojiReactions;
  }
  
  await messageRef.update({'reactions': reactions});
}
```

---

## üîê –ü–†–ê–í–ò–õ–ê –ë–ï–ó–ü–ï–ö–ò FIRESTORE

### Security Rules (–ø—Ä–∏–∫–ª–∞–¥)

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // –ß–∞—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ —Ç—ñ–ª—å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º
    match /chat_rooms/{chatId} {
      allow read, write: if request.auth != null;
      
      // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–Ω—ñ —Ç—ñ–ª—å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–º
      match /messages/{messageId} {
        allow read, write: if request.auth != null;
      }
    }
    
    // –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–Ω—ñ —Ç—ñ–ª—å–∫–∏ –≤–ª–∞—Å–Ω–∏–∫—É
    match /saved_messages/{savedId} {
      allow read, write: if request.auth != null 
        && resource.data.userId == request.auth.uid;
    }
  }
}
```

---

## üìä –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ò–• –í –ü–†–û–Ñ–ö–¢–Ü

### –ö–æ–ª–µ–∫—Ü—ñ—è `chat_rooms`
```json
{
  "chatId": {
    "name": "–ù–∞–∑–≤–∞ —á–∞—Ç—É",
    "lastMessage": {
      "text": "–û—Å—Ç–∞–Ω–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è",
      "sender": "email@example.com"
    },
    "lastMessageTime": "2024-01-15T10:30:00Z",
    "messages": {
      "messageId": {
        "text": "–¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è",
        "sender": "email@example.com",
        "senderId": "userId",
        "timestamp": "2024-01-15T10:30:00Z",
        "reactions": {
          "üëç": ["userId1", "userId2"],
          "‚ù§Ô∏è": ["userId3"]
        }
      }
    }
  }
}
```

### –ö–æ–ª–µ–∫—Ü—ñ—è `saved_messages`
```json
{
  "savedId": {
    "userId": "userId",
    "messageId": "messageId",
    "chatId": "chatId",
    "text": "–¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è",
    "originalSender": "email@example.com",
    "savedAt": "2024-01-15T10:30:00Z"
  }
}
```

---

## ‚úÖ –ü–Ü–î–°–£–ú–û–ö

### –ö–ª—é—á–æ–≤—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó:

1. **Firebase Core** - —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
2. **Firebase Auth** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
3. **Cloud Firestore** - –±–∞–∑–∞ –¥–∞–Ω–∏—Ö real-time
4. **StreamBuilder** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI
5. **QuerySnapshot / DocumentSnapshot** - —Ä–æ–±–æ—Ç–∞ –∑ –¥–∞–Ω–∏–º–∏
6. **Firebase Analytics** - –∑–±—ñ—Ä –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏
7. **Firebase Crashlytics** - –∑–≤—ñ—Ç–∏ –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏

### –ü–µ—Ä–µ–≤–∞–≥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Firebase:

‚úÖ –®–≤–∏–¥–∫–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ –±–µ–∑ backend
‚úÖ Real-time —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
‚úÖ –í–±—É–¥–æ–≤–∞–Ω–∞ –±–µ–∑–ø–µ–∫–∞
‚úÖ –ö—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ñ—Å—Ç—å

### –ù–∞–π–≤–∞–∂–ª–∏–≤—ñ—à—ñ –≤—ñ–¥–∂–µ—Ç–∏:

1. **StreamBuilder** - –¥–ª—è real-time –¥–∞–Ω–∏—Ö
2. **ListView.builder** - –¥–ª—è —Å–ø–∏—Å–∫—ñ–≤
3. **TextField** - –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è
4. **Card** - –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
5. **Scaffold** - –±–∞–∑–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –µ–∫—Ä–∞–Ω—É

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–æ –∑–∞—Ö–∏—Å—Ç—É –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏*


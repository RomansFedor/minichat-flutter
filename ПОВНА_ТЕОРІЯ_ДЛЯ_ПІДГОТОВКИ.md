# üìö –ü–û–í–ù–ê –¢–ï–û–†–Ü–Ø –î–õ–Ø –ü–Ü–î–ì–û–¢–û–í–ö–ò
## Flutter –≤—ñ–¥–∂–µ—Ç–∏, Firebase —Ç–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Ññ6

---

# üìã –ó–ú–Ü–°–¢

1. [Flutter –≤—ñ–¥–∂–µ—Ç–∏](#1-flutter-–≤—ñ–¥–∂–µ—Ç–∏)
2. [Firebase - –∑–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è](#2-firebase-–∑–∞–≥–∞–ª—å–Ω–∞-—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è)
3. [Cloud Firestore](#3-cloud-firestore)
4. [Firebase Authentication](#4-firebase-authentication)
5. [–ü–∞—Ç—Ç–µ—Ä–Ω Repository](#5-–ø–∞—Ç—Ç–µ—Ä–Ω-repository)
6. [BLoC –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è](#6-bloc-–¥–ª—è-—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è-—Ç–∞-—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è)
7. [–ü—Ä–∞–≤–∏–ª–∞ –±–µ–∑–ø–µ–∫–∏ Firestore](#7-–ø—Ä–∞–≤–∏–ª–∞-–±–µ–∑–ø–µ–∫–∏-firestore)
8. [–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Ññ6 - –ó–∞–≤–¥–∞–Ω–Ω—è —Ç–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è](#8-–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞-—Ä–æ–±–æ—Ç–∞-6)

---

# 1. FLUTTER –í–Ü–î–ñ–ï–¢–ò

## 1.1. Layout –≤—ñ–¥–∂–µ—Ç–∏

### Scaffold
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ë–∞–∑–æ–≤–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è Material Design –µ–∫—Ä–∞–Ω—ñ–≤ –∑ AppBar, body —Ç–∞ bottomNavigationBar.

```dart
Scaffold(
  appBar: AppBar(
    title: Text('–ó–∞–≥–æ–ª–æ–≤–æ–∫'),
    actions: [
      IconButton(
        icon: Icon(Icons.search),
        onPressed: () {},
      ),
    ],
  ),
  body: Center(child: Text('–ö–æ–Ω—Ç–µ–Ω—Ç')),
  bottomNavigationBar: NavigationBar(
    selectedIndex: 0,
    onDestinationSelected: (index) {},
    destinations: [...],
  ),
)
```

### Column / Row
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –†–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –≤—ñ–¥–∂–µ—Ç—ñ–≤ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ (Column) –∞–±–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ (Row).

```dart
Column(
  mainAxisAlignment: MainAxisAlignment.center,
  crossAxisAlignment: CrossAxisAlignment.start,
  children: [
    Text('–ï–ª–µ–º–µ–Ω—Ç 1'),
    Text('–ï–ª–µ–º–µ–Ω—Ç 2'),
    Expanded(child: Container()), // –ó–∞–π–º–∞—î –∑–∞–ª–∏—à–æ–∫ –ø—Ä–æ—Å—Ç–æ—Ä—É
  ],
)

Row(
  mainAxisAlignment: MainAxisAlignment.spaceBetween,
  children: [
    Icon(Icons.star),
    Text('–†–µ–π—Ç–∏–Ω–≥'),
  ],
)
```

### Container
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é —Å—Ç–∏–ª—ñ–∑–∞—Ü—ñ—ó.

```dart
Container(
  padding: EdgeInsets.all(16),
  margin: EdgeInsets.symmetric(vertical: 8),
  decoration: BoxDecoration(
    color: Colors.blue,
    borderRadius: BorderRadius.circular(12),
    boxShadow: [
      BoxShadow(
        color: Colors.black.withOpacity(0.1),
        blurRadius: 4,
        offset: Offset(0, 2),
      ),
    ],
  ),
  child: Text('–¢–µ–∫—Å—Ç'),
)
```

### Expanded / Flexible
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ó–∞–π–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –≤ Row/Column.

```dart
Row(
  children: [
    Icon(Icons.star),
    Expanded(
      flex: 2, // –ó–∞–π–º–∞—î 2 —á–∞—Å—Ç–∏–Ω–∏ –ø—Ä–æ—Å—Ç–æ—Ä—É
      child: Text('–¢–µ–∫—Å—Ç –∑–∞–π–º–∞—î –≤–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä'),
    ),
    Flexible(
      flex: 1, // –ó–∞–π–º–∞—î 1 —á–∞—Å—Ç–∏–Ω—É –ø—Ä–æ—Å—Ç–æ—Ä—É
      child: Icon(Icons.favorite),
    ),
  ],
)
```

### Stack
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ù–∞–∫–ª–∞–¥–∞–Ω–Ω—è –≤—ñ–¥–∂–µ—Ç—ñ–≤ –æ–¥–∏–Ω –Ω–∞ –æ–¥–Ω–æ–≥–æ.

```dart
Stack(
  children: [
    Container(color: Colors.blue),
    Positioned(
      top: 10,
      right: 10,
      child: Icon(Icons.close),
    ),
  ],
)
```

## 1.2. –°–ø–∏—Å–∫–∏ —Ç–∞ –¥–∞–Ω—ñ

### ListView.builder
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ï—Ñ–µ–∫—Ç–∏–≤–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—ñ–≤ (—Å—Ç–≤–æ—Ä—é—î –µ–ª–µ–º–µ–Ω—Ç–∏ "–Ω–∞ –ª—å–æ—Ç—É").

```dart
ListView.builder(
  itemCount: items.length,
  itemBuilder: (context, index) {
    return ListTile(
      leading: Icon(Icons.chat),
      title: Text(items[index].name),
      subtitle: Text(items[index].description),
      trailing: Icon(Icons.arrow_forward),
      onTap: () {
        // –û–±—Ä–æ–±–∫–∞ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è
      },
    );
  },
)
```

### GridView.builder
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É –≤–∏–≥–ª—è–¥—ñ —Å—ñ—Ç–∫–∏.

```dart
GridView.builder(
  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
    crossAxisCount: 2, // –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ–ª–æ–Ω–æ–∫
    crossAxisSpacing: 8,
    mainAxisSpacing: 8,
    childAspectRatio: 0.8,
  ),
  itemCount: items.length,
  itemBuilder: (context, index) {
    return Card(child: ...);
  },
)
```

### Card
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** Material Design –∫–∞—Ä—Ç–∫–∞ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.

```dart
Card(
  elevation: 2,
  shape: RoundedRectangleBorder(
    borderRadius: BorderRadius.circular(16),
  ),
  child: ListTile(
    leading: CircleAvatar(
      backgroundImage: NetworkImage(avatarUrl),
    ),
    title: Text('–ù–∞–∑–≤–∞ —á–∞—Ç—É'),
    subtitle: Text('–û—Å—Ç–∞–Ω–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è'),
    trailing: Text('10:30'),
  ),
)
```

### ListTile
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫—É –∑ leading, title, subtitle, trailing.

```dart
ListTile(
  leading: Icon(Icons.person),
  title: Text('–Ü–º\'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞'),
  subtitle: Text('–°—Ç–∞—Ç—É—Å'),
  trailing: IconButton(
    icon: Icon(Icons.more_vert),
    onPressed: () {},
  ),
  onTap: () {},
)
```

## 1.3. –§–æ—Ä–º–∏ —Ç–∞ –≤–≤–µ–¥–µ–Ω–Ω—è

### TextField / TextFormField
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ü–æ–ª–µ –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É.

```dart
TextField(
  controller: _controller,
  decoration: InputDecoration(
    labelText: 'Email',
    hintText: '–í–≤–µ–¥—ñ—Ç—å email',
    prefixIcon: Icon(Icons.email),
    border: OutlineInputBorder(
      borderRadius: BorderRadius.circular(12),
    ),
    filled: true,
    fillColor: Colors.grey[100],
  ),
  keyboardType: TextInputType.emailAddress,
  obscureText: false, // –î–ª—è –ø–∞—Ä–æ–ª—è: true
  onChanged: (value) {
    // –û–±—Ä–æ–±–∫–∞ –∑–º—ñ–Ω
  },
  onSubmitted: (value) {
    // –û–±—Ä–æ–±–∫–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
  },
)
```

### Form —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–æ–ª—ñ–≤ —Ñ–æ—Ä–º–∏ –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é.

```dart
Form(
  key: _formKey,
  child: Column(
    children: [
      TextFormField(
        controller: _emailController,
        decoration: InputDecoration(labelText: 'Email'),
        validator: (value) {
          if (value == null || value.isEmpty) {
            return '–ü–æ–ª–µ –æ–±–æ–≤\'—è–∑–∫–æ–≤–µ';
          }
          if (!value.contains('@')) {
            return '–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç email';
          }
          return null; // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–æ–π–¥–µ–Ω–∞
        },
      ),
      ElevatedButton(
        onPressed: () {
          if (_formKey.currentState!.validate()) {
            // –§–æ—Ä–º–∞ –≤–∞–ª—ñ–¥–Ω–∞, –æ–±—Ä–æ–±–∫–∞ –¥–∞–Ω–∏—Ö
          }
        },
        child: Text('–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏'),
      ),
    ],
  ),
)
```

### ChoiceChip
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ß—ñ–ø –¥–ª—è –≤–∏–±–æ—Ä—É –∑ –∫—ñ–ª—å–∫–æ—Ö –æ–ø—Ü—ñ–π.

```dart
Wrap(
  spacing: 8,
  children: [
    ChoiceChip(
      label: Text('–í—Å—ñ'),
      selected: _selectedFilter == 'all',
      onSelected: (selected) {
        setState(() {
          _selectedFilter = 'all';
        });
      },
    ),
    ChoiceChip(
      label: Text('–û–Ω–ª–∞–π–Ω'),
      selected: _selectedFilter == 'online',
      onSelected: (selected) {
        setState(() {
          _selectedFilter = 'online';
        });
      },
    ),
  ],
)
```

## 1.4. –î—ñ–∞–ª–æ–≥–∏ —Ç–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è

### AlertDialog
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ú–æ–¥–∞–ª—å–Ω–µ –¥—ñ–∞–ª–æ–≥–æ–≤–µ –≤—ñ–∫–Ω–æ.

```dart
showDialog(
  context: context,
  builder: (context) => AlertDialog(
    title: Text('–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è'),
    content: Text('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏?'),
    actions: [
      TextButton(
        onPressed: () => Navigator.pop(context),
        child: Text('–°–∫–∞—Å—É–≤–∞—Ç–∏'),
      ),
      TextButton(
        onPressed: () {
          Navigator.pop(context, true); // –ü–æ–≤–µ—Ä—Ç–∞—î true
          // –í–∏–∫–æ–Ω–∞—Ç–∏ –¥—ñ—é
        },
        child: Text('–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏'),
      ),
    ],
  ),
).then((confirmed) {
  if (confirmed == true) {
    // –î—ñ—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∞
  }
});
```

### SnackBar
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –¢–∏–º—á–∞—Å–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–Ω–∏–∑—É –µ–∫—Ä–∞–Ω—É.

```dart
ScaffoldMessenger.of(context).showSnackBar(
  SnackBar(
    content: Text('–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ'),
    duration: Duration(seconds: 2),
    behavior: SnackBarBehavior.floating,
    action: SnackBarAction(
      label: '–°–∫–∞—Å—É–≤–∞—Ç–∏',
      onPressed: () {},
    ),
  ),
);
```

### CircularProgressIndicator
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.

```dart
if (isLoading)
  Center(child: CircularProgressIndicator())
else
  // –ö–æ–Ω—Ç–µ–Ω—Ç
```

## 1.5. –ö–Ω–æ–ø–∫–∏

### ElevatedButton
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ö–Ω–æ–ø–∫–∞ –∑ –µ—Ñ–µ–∫—Ç–æ–º –ø—ñ–¥–Ω—è—Ç—Ç—è.

```dart
ElevatedButton(
  onPressed: isEnabled ? () {
    // –î—ñ—è
  } : null, // null = –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
  style: ElevatedButton.styleFrom(
    backgroundColor: Colors.blue,
    foregroundColor: Colors.white,
    padding: EdgeInsets.symmetric(horizontal: 24, vertical: 12),
    shape: RoundedRectangleBorder(
      borderRadius: BorderRadius.circular(12),
    ),
  ),
  child: Text('–ù–∞—Ç–∏—Å–Ω—É—Ç–∏'),
)
```

### TextButton
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –¢–µ–∫—Å—Ç–æ–≤–∞ –∫–Ω–æ–ø–∫–∞ –±–µ–∑ —Ñ–æ–Ω—É.

```dart
TextButton(
  onPressed: () {},
  child: Text('–°–∫–∞—Å—É–≤–∞—Ç–∏'),
)
```

### IconButton
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ö–Ω–æ–ø–∫–∞ –∑ —ñ–∫–æ–Ω–∫–æ—é.

```dart
IconButton(
  icon: Icon(Icons.send),
  onPressed: () {},
  tooltip: '–ù–∞–¥—ñ—Å–ª–∞—Ç–∏',
  color: Colors.blue,
)
```

## 1.6. –Ü–Ω—à—ñ –∫–æ—Ä–∏—Å–Ω—ñ –≤—ñ–¥–∂–µ—Ç–∏

### SafeArea
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –î–æ–¥–∞—î –≤—ñ–¥—Å—Ç—É–ø–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (notch, status bar).

```dart
SafeArea(
  child: Column(
    children: [...],
  ),
)
```

### Padding / SizedBox
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤—ñ–¥—Å—Ç—É–ø—ñ–≤.

```dart
Padding(
  padding: EdgeInsets.all(16),
  child: Text('–¢–µ–∫—Å—Ç'),
)

SizedBox(
  width: 100,
  height: 50,
  child: Container(),
)

SizedBox(height: 20) // –ü—Ä–æ—Å—Ç—ñ—Ä –º—ñ–∂ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏
```

### RefreshIndicator
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** Pull-to-refresh —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å.

```dart
RefreshIndicator(
  onRefresh: () async {
    // –û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ
    await loadData();
  },
  child: ListView.builder(...),
)
```

### InkWell / GestureDetector
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –û–±—Ä–æ–±–∫–∞ –Ω–∞—Ç–∏—Å–∫–∞–Ω—å —Ç–∞ –∂–µ—Å—Ç—ñ–≤.

```dart
InkWell(
  onTap: () {},
  borderRadius: BorderRadius.circular(8),
  child: Container(
    padding: EdgeInsets.all(16),
    child: Text('–ù–∞—Ç–∏—Å–Ω–∏ –º–µ–Ω–µ'),
  ),
)

GestureDetector(
  onTap: () {},
  onLongPress: () {},
  child: Container(...),
)
```

---

# 2. FIREBASE - –ó–ê–ì–ê–õ–¨–ù–ê –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø

## 2.1. –©–æ —Ç–∞–∫–µ Firebase?

**Firebase** - —Ü–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤—ñ–¥ Google –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ –º–æ–±—ñ–ª—å–Ω–∏—Ö —Ç–∞ –≤–µ–±-–¥–æ–¥–∞—Ç–∫—ñ–≤, —è–∫–∞ –Ω–∞–¥–∞—î –Ω–∞–±—ñ—Ä —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Ç–∞ —Å–µ—Ä–≤—ñ—Å—ñ–≤ –¥–ª—è backend-—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –ø–∏—Å–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä–Ω–∏–π –∫–æ–¥.

### –û—Å–Ω–æ–≤–Ω—ñ –ø–µ—Ä–µ–≤–∞–≥–∏:
1. **Backend as a Service (BaaS)** - –≥–æ—Ç–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏ –±–µ–∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä—ñ–≤
2. **Real-time —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –º—ñ–∂ –∫–ª—ñ—î–Ω—Ç–∞–º–∏
3. **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
4. **–ë–µ–∑–ø–µ–∫–∞** - –≤–±—É–¥–æ–≤–∞–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–ø–µ–∫–∏ —Ç–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
5. **–ö—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ñ—Å—Ç—å** - –ø—Ä–∞—Ü—é—î –Ω–∞ Android, iOS, Web, Desktop

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ Firebase –≤ –ø—Ä–æ—î–∫—Ç—ñ:
```
Flutter App
    ‚îÇ
    ‚îú‚îÄ‚îÄ Firebase Core (—ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è)
    ‚îú‚îÄ‚îÄ Firebase Auth (–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è)
    ‚îú‚îÄ‚îÄ Cloud Firestore (–±–∞–∑–∞ –¥–∞–Ω–∏—Ö)
    ‚îú‚îÄ‚îÄ Firebase Analytics (–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞)
    ‚îî‚îÄ‚îÄ Firebase Crashlytics (–∑–≤—ñ—Ç–∏ –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏)
```

## 2.2. Firebase Core

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ë–∞–∑–æ–≤–∏–π –ø–∞–∫–µ—Ç –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Firebase –≤ –¥–æ–¥–∞—Ç–∫—É.

```dart
import 'package:firebase_core/firebase_core.dart';

Future<void> main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  
  runApp(MyApp());
}
```

**–í–∞–∂–ª–∏–≤–æ:**
- –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ –¥–æ–¥–∞—Ç–∫—É
- `WidgetsFlutterBinding.ensureInitialized()` –º–∞—î –±—É—Ç–∏ –≤–∏–∫–ª–∏–∫–∞–Ω–∏–π –ø–µ—Ä–µ–¥ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é
- –ú–∞—î –±—É—Ç–∏ –≤–∏–∫–ª–∏–∫–∞–Ω–∏–π –ø–µ—Ä–µ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —ñ–Ω—à–∏—Ö Firebase —Å–µ—Ä–≤—ñ—Å—ñ–≤

---

# 3. CLOUD FIRESTORE

## 3.1. –û—Å–Ω–æ–≤–Ω—ñ –ø–æ–Ω—è—Ç—Ç—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö:
```
Firestore Database
    ‚îÇ
    ‚îî‚îÄ‚îÄ –ö–æ–ª–µ–∫—Ü—ñ—ó (Collections)
        ‚îî‚îÄ‚îÄ –î–æ–∫—É–º–µ–Ω—Ç–∏ (Documents)
            ‚îú‚îÄ‚îÄ –ü–æ–ª—è (Fields)
            ‚îî‚îÄ‚îÄ –ü—ñ–¥–∫–æ–ª–µ–∫—Ü—ñ—ó (Subcollections)
```

### –¢–∏–ø–∏ –¥–∞–Ω–∏—Ö:
- **String** - —Ä—è–¥–æ–∫
- **Number** - —á–∏—Å–ª–æ
- **Boolean** - –±—É–ª–µ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è
- **Map** - –æ–±'—î–∫—Ç
- **Array** - –º–∞—Å–∏–≤
- **Timestamp** - –¥–∞—Ç–∞/—á–∞—Å
- **GeoPoint** - –≥–µ–æ–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏
- **Null** - –ø—É—Å—Ç–µ –∑–Ω–∞—á–µ–Ω–Ω—è
- **Reference** - –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —ñ–Ω—à–∏–π –¥–æ–∫—É–º–µ–Ω—Ç

## 3.2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–µ–∫—Ü—ñ–π –≤ –ø—Ä–æ—î–∫—Ç—ñ

### –ö–æ–ª–µ–∫—Ü—ñ—è `chat_rooms`
```json
{
  "chatId": {
    "name": "–ù–∞–∑–≤–∞ —á–∞—Ç—É",
    "createdBy": "user123uid",
    "createdAt": "2025-01-15T10:30:00Z",
    "lastMessage": {
      "text": "–û—Å—Ç–∞–Ω–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è",
      "sender": "user@example.com"
    },
    "lastMessageTime": "2025-01-15T14:20:00Z",
    "participants": ["user123", "user456"]
  }
}
```

**–ü–æ–ª—è:**
- `name` (String) - –Ω–∞–∑–≤–∞ —á–∞—Ç—É
- `createdBy` (String) - UID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–∏–π —Å—Ç–≤–æ—Ä–∏–≤ —á–∞—Ç
- `createdAt` (Timestamp) - –¥–∞—Ç–∞ —Ç–∞ —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
- `lastMessage` (Map) - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –æ—Å—Ç–∞–Ω–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- `lastMessageTime` (Timestamp) - —á–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- `participants` (Array<String>) - —Å–ø–∏—Å–æ–∫ UID —É—á–∞—Å–Ω–∏–∫—ñ–≤

### –ü—ñ–¥–∫–æ–ª–µ–∫—Ü—ñ—è `chat_rooms/{chatId}/messages`
```json
{
  "messageId": {
    "text": "–¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è",
    "sender": "user@example.com",
    "senderId": "user123uid",
    "timestamp": "2025-01-15T14:20:00Z",
    "reactions": {
      "‚ù§Ô∏è": ["user456uid", "user789uid"],
      "üëç": ["user123uid"]
    },
    "isEdited": false,
    "editedAt": null
  }
}
```

**–ü–æ–ª—è:**
- `text` (String) - —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- `sender` (String) - email –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫–∞
- `senderId` (String) - UID –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫–∞
- `timestamp` (Timestamp) - —á–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
- `reactions` (Map) - —Ä–µ–∞–∫—Ü—ñ—ó –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- `isEdited` (Boolean) - —á–∏ –±—É–ª–æ –≤—ñ–¥—Ä–µ–¥–∞–≥–æ–≤–∞–Ω–µ
- `editedAt` (Timestamp) - —á–∞—Å —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è

### –ö–æ–ª–µ–∫—Ü—ñ—è `saved_messages`
```json
{
  "savedId": {
    "userId": "user123uid",
    "messageId": "msg456id",
    "chatId": "chat789id",
    "messageText": "–¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è",
    "sender": "user@example.com",
    "savedAt": "2025-01-15T15:00:00Z",
    "note": "–ü—Ä–∏–º—ñ—Ç–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"
  }
}
```

## 3.3. –û—Å–Ω–æ–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ Firestore

### –ß–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–µ)

```dart
import 'package:cloud_firestore/cloud_firestore.dart';

// –û—Ç—Ä–∏–º–∞—Ç–∏ –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç
final doc = await FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc(chatId)
    .get();

if (doc.exists) {
  final data = doc.data(); // Map<String, dynamic>?
  print(data?['name']);
}

// –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó
final snapshot = await FirebaseFirestore.instance
    .collection('chat_rooms')
    .get();

final docs = snapshot.docs; // List<QueryDocumentSnapshot>
for (var doc in docs) {
  print(doc.data());
}
```

### –ß–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö (real-time Stream)

```dart
// Stream –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
Stream<DocumentSnapshot> stream = FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc(chatId)
    .snapshots();

stream.listen((doc) {
  if (doc.exists) {
    final data = doc.data();
    print(data);
  }
});

// Stream –∫–æ–ª–µ–∫—Ü—ñ—ó
Stream<QuerySnapshot> stream = FirebaseFirestore.instance
    .collection('chat_rooms')
    .snapshots();

stream.listen((snapshot) {
  for (var doc in snapshot.docs) {
    print(doc.data());
  }
});
```

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö

```dart
// –î–æ–¥–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º ID
final docRef = await FirebaseFirestore.instance
    .collection('chat_rooms')
    .add({
      'name': '–ù–æ–≤–∏–π —á–∞—Ç',
      'createdBy': user.uid,
      'createdAt': FieldValue.serverTimestamp(),
    });

final chatId = docRef.id; // –û—Ç—Ä–∏–º–∞—Ç–∏ ID

// –î–æ–¥–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º ID
await FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc('myChatId')
    .set({
      'name': '–ù–æ–≤–∏–π —á–∞—Ç',
      'createdAt': FieldValue.serverTimestamp(),
    });
```

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö

```dart
await FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc(chatId)
    .update({
      'lastMessage': {
        'text': '–ù–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è',
        'sender': user.email,
      },
      'lastMessageTime': FieldValue.serverTimestamp(),
    });

// –û–Ω–æ–≤–∏—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ –ø–æ–ª–µ –≤ –º–∞—Å–∏–≤—ñ
await FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc(chatId)
    .update({
      'participants': FieldValue.arrayUnion([newUserId]),
    });
```

### –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö

```dart
// –í–∏–¥–∞–ª–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç
await FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc(chatId)
    .delete();

// –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–ª–µ
await FirebaseFirestore.instance
    .collection('chat_rooms')
    .doc(chatId)
    .update({
      'lastMessage': FieldValue.delete(),
    });
```

### –ó–∞–ø–∏—Ç–∏ –∑ —É–º–æ–≤–∞–º–∏

```dart
// –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
FirebaseFirestore.instance
    .collection('chat_rooms')
    .orderBy('lastMessageTime', descending: true)
    .limit(10)
    .get();

// –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
FirebaseFirestore.instance
    .collection('chat_rooms')
    .where('createdBy', isEqualTo: userId)
    .get();

// –ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –∑–∞–ø–∏—Ç
FirebaseFirestore.instance
    .collection('chat_rooms')
    .where('createdBy', isEqualTo: userId)
    .orderBy('createdAt', descending: true)
    .limit(10)
    .get();

// –û–ø–µ—Ä–∞—Ç–æ—Ä–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
.where('count', isGreaterThan: 10)
.where('count', isLessThan: 100)
.where('tags', arrayContains: 'important')
.where('status', whereIn: ['active', 'pending'])
```

### –°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è FieldValue

```dart
// –°–µ—Ä–≤–µ—Ä–Ω–∏–π —á–∞—Å (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è Firebase)
FieldValue.serverTimestamp()

// –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–ª–µ
FieldValue.delete()

// –î–æ–¥–∞—Ç–∏ –¥–æ –º–∞—Å–∏–≤—É
FieldValue.arrayUnion(['item1', 'item2'])

// –í–∏–¥–∞–ª–∏—Ç–∏ –∑ –º–∞—Å–∏–≤—É
FieldValue.arrayRemove(['item1'])

// –ó–±—ñ–ª—å—à–∏—Ç–∏ —á–∏—Å–ª–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è
FieldValue.increment(1)
```

## 3.4. StreamBuilder –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ Firestore

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –í—ñ–¥–∂–µ—Ç, —è–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î UI –ø—Ä–∏ –∑–º—ñ–Ω—ñ –¥–∞–Ω–∏—Ö —É Stream.

```dart
StreamBuilder<QuerySnapshot>(
  stream: FirebaseFirestore.instance
      .collection('chat_rooms')
      .orderBy('lastMessageTime', descending: true)
      .snapshots(),
  builder: (context, snapshot) {
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
    if (snapshot.connectionState == ConnectionState.waiting) {
      return Center(child: CircularProgressIndicator());
    }
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–º–∏–ª–æ–∫
    if (snapshot.hasError) {
      return Center(child: Text('–ü–æ–º–∏–ª–∫–∞: ${snapshot.error}'));
    }
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö
    if (!snapshot.hasData || snapshot.data!.docs.isEmpty) {
      return Center(child: Text('–ù–µ–º–∞—î —á–∞—Ç—ñ–≤'));
    }
    
    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
    final chats = snapshot.data!.docs;
    return ListView.builder(
      itemCount: chats.length,
      itemBuilder: (context, index) {
        final chat = chats[index];
        final data = chat.data() as Map<String, dynamic>;
        return Card(
          child: ListTile(
            title: Text(data['name'] ?? '–ë–µ–∑ –Ω–∞–∑–≤–∏'),
            subtitle: Text(data['lastMessage']?['text'] ?? ''),
            onTap: () {
              Navigator.push(
                context,
                MaterialPageRoute(
                  builder: (_) => ChatRoomScreen(
                    chatId: chat.id,
                    chatName: data['name'],
                  ),
                ),
              );
            },
          ),
        );
      },
    );
  },
)
```

**–°—Ç–∞–Ω–∏ StreamBuilder:**
- `ConnectionState.waiting` - –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- `ConnectionState.active` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- `ConnectionState.done` - –ø–æ—Ç—ñ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ

**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ snapshot:**
- `connectionState` - —Å—Ç–∞–Ω –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- `hasData` - —á–∏ —î –¥–∞–Ω—ñ
- `hasError` - —á–∏ —î –ø–æ–º–∏–ª–∫–∞
- `data` - –¥–∞–Ω—ñ –∑ –ø–æ—Ç–æ–∫—É
- `error` - –æ–±'—î–∫—Ç –ø–æ–º–∏–ª–∫–∏

---

# 4. FIREBASE AUTHENTICATION

## 4.1. –û—Å–Ω–æ–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó

```dart
import 'package:firebase_auth/firebase_auth.dart';

final auth = FirebaseAuth.instance;

// –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
final user = auth.currentUser;
if (user != null) {
  print('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${user.email}');
  print('UID: ${user.uid}');
}

// –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
try {
  final credential = await auth.createUserWithEmailAndPassword(
    email: email,
    password: password,
  );
  print('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä–µ–Ω–æ: ${credential.user?.uid}');
} on FirebaseAuthException catch (e) {
  print('–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: ${e.message}');
}

// –í—Ö—ñ–¥ —ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
try {
  final credential = await auth.signInWithEmailAndPassword(
    email: email,
    password: password,
  );
  print('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–≤—ñ–π—à–æ–≤: ${credential.user?.email}');
} on FirebaseAuthException catch (e) {
  print('–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É: ${e.message}');
}

// –í–∏—Ö—ñ–¥
await auth.signOut();
```

## 4.2. –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

```dart
try {
  await auth.signInWithEmailAndPassword(
    email: email,
    password: password,
  );
} on FirebaseAuthException catch (e) {
  String message = '–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó';
  switch (e.code) {
    case 'user-not-found':
      message = '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π';
      break;
    case 'wrong-password':
      message = '–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å';
      break;
    case 'email-already-in-use':
      message = 'Email –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è';
      break;
    case 'weak-password':
      message = '–ü–∞—Ä–æ–ª—å –∑–∞–Ω–∞–¥—Ç–æ —Å–ª–∞–±–∫–∏–π';
      break;
    case 'invalid-email':
      message = '–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç email';
      break;
    case 'user-disabled':
      message = '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π';
      break;
  }
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text(message)),
  );
}
```

## 4.3. –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ User

```dart
final user = FirebaseAuth.instance.currentUser;

user?.uid           // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
user?.email         // Email –∞–¥—Ä–µ—Å–∞
user?.displayName   // –í—ñ–¥–æ–±—Ä–∞–∂—É–≤–∞–Ω–µ —ñ–º'—è
user?.photoURL      // URL —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é
user?.emailVerified // –ß–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ email
user?.metadata      // –ú–µ—Ç–∞–¥–∞–Ω—ñ (–¥–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, –æ—Å—Ç–∞–Ω–Ω—ñ–π –≤—Ö—ñ–¥)
```

## 4.4. –°–ª—É—Ö–∞—á –∑–º—ñ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

```dart
FirebaseAuth.instance.authStateChanges().listen((user) {
  if (user == null) {
    print('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–π—à–æ–≤');
  } else {
    print('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–≤—ñ–π—à–æ–≤: ${user.email}');
  }
});
```

---

# 5. –ü–ê–¢–¢–ï–†–ù REPOSITORY

## 5.1. –©–æ —Ç–∞–∫–µ Repository?

**Repository** - —Ü–µ –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è, —è–∫–∏–π —ñ–Ω–∫–∞–ø—Å—É–ª—é—î –ª–æ–≥—ñ–∫—É –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö —ñ –Ω–∞–¥–∞—î —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –¥–∞–Ω–∏–º–∏, –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —ó—Ö –¥–∂–µ—Ä–µ–ª–∞ (Firestore, REST API, –ª–æ–∫–∞–ª—å–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö).

### –ü–µ—Ä–µ–≤–∞–≥–∏:
1. **–†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç–µ–π** - –ª–æ–≥—ñ–∫–∞ –¥–∞–Ω–∏—Ö –≤—ñ–¥–æ–∫—Ä–µ–º–ª–µ–Ω–∞ –≤—ñ–¥ UI
2. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è** - –ª–µ–≥–∫–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ mock-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó
3. **–ì–Ω—É—á–∫—ñ—Å—Ç—å** - –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –¥–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö –±–µ–∑ –∑–º—ñ–Ω–∏ UI
4. **–ü–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è** - —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ —Ä—ñ–∑–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö
5. **–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫** - —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

## 5.2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Repository

### –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```dart
abstract class ChatsRepository {
  Future<List<ChatModel>> getChats();
  Stream<List<ChatModel>> getChatsStream();
  Future<ChatModel?> getChatById(String chatId);
  Future<String> createChat({required String name});
  Future<void> updateChat({required String chatId, String? name});
  Future<void> deleteChat(String chatId);
  Future<void> updateLastMessage({
    required String chatId,
    required String text,
    required String sender,
  });
}
```

### –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Firestore

```dart
class FirestoreChatsRepository implements ChatsRepository {
  final FirebaseFirestore _firestore;
  final FirebaseAuth _auth;

  FirestoreChatsRepository({
    FirebaseFirestore? firestore,
    FirebaseAuth? auth,
  })  : _firestore = firestore ?? FirebaseFirestore.instance,
        _auth = auth ?? FirebaseAuth.instance;

  @override
  Future<List<ChatModel>> getChats() async {
    try {
      final snapshot = await _firestore
          .collection('chat_rooms')
          .orderBy('lastMessageTime', descending: true)
          .get();

      return snapshot.docs.map((doc) {
        return ChatModel.fromFirestore(doc.id, doc.data());
      }).toList();
    } catch (e) {
      throw Exception('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–∞—Ç—ñ–≤: $e');
    }
  }

  @override
  Stream<List<ChatModel>> getChatsStream() {
    return _firestore
        .collection('chat_rooms')
        .orderBy('lastMessageTime', descending: true)
        .snapshots()
        .map((snapshot) {
      return snapshot.docs.map((doc) {
        return ChatModel.fromFirestore(doc.id, doc.data());
      }).toList();
    });
  }

  @override
  Future<String> createChat({required String name}) async {
    try {
      final user = _auth.currentUser;
      if (user == null) {
        throw Exception('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π');
      }

      final docRef = await _firestore.collection('chat_rooms').add({
        'name': name,
        'createdBy': user.uid,
        'createdAt': FieldValue.serverTimestamp(),
        'lastMessage': null,
        'lastMessageTime': null,
      });

      return docRef.id;
    } catch (e) {
      throw Exception('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —á–∞—Ç—É: $e');
    }
  }

  // –Ü–Ω—à—ñ –º–µ—Ç–æ–¥–∏...
}
```

## 5.3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Repository –≤ BLoC

```dart
class ChatsBloc extends Bloc<ChatsEvent, ChatsState> {
  final ChatsRepository _chatsRepository;

  ChatsBloc({ChatsRepository? chatsRepository})
      : _chatsRepository = chatsRepository ?? FirestoreChatsRepository(),
        super(const ChatsInitialState()) {
    on<LoadChatsEvent>(_onLoadChatsEvent);
  }

  Future<void> _onLoadChatsEvent(
    LoadChatsEvent event,
    Emitter<ChatsState> emit,
  ) async {
    emit(ChatsLoadingState(data: state.data));

    try {
      final chats = await _chatsRepository.getChats();
      emit(ChatsDataState(data: chats));
    } catch (e) {
      emit(ChatsErrorState(
        error: e.toString(),
        data: state.data,
      ));
    }
  }
}
```

## 5.4. –ú–æ–¥–µ–ª—ñ –¥–∞–Ω–∏—Ö

### ChatModel

```dart
import 'package:cloud_firestore/cloud_firestore.dart';

class ChatModel {
  final String id;
  final String name;
  final String createdBy;
  final DateTime? createdAt;
  final LastMessage? lastMessage;
  final DateTime? lastMessageTime;

  ChatModel({
    required this.id,
    required this.name,
    required this.createdBy,
    this.createdAt,
    this.lastMessage,
    this.lastMessageTime,
  });

  factory ChatModel.fromFirestore(String id, Map<String, dynamic> data) {
    return ChatModel(
      id: id,
      name: data['name'] as String? ?? '–ë–µ–∑ –Ω–∞–∑–≤–∏',
      createdBy: data['createdBy'] as String? ?? '',
      createdAt: (data['createdAt'] as Timestamp?)?.toDate(),
      lastMessage: data['lastMessage'] != null
          ? LastMessage.fromMap(data['lastMessage'] as Map<String, dynamic>)
          : null,
      lastMessageTime: (data['lastMessageTime'] as Timestamp?)?.toDate(),
    );
  }

  Map<String, dynamic> toFirestore() {
    return {
      'name': name,
      'createdBy': createdBy,
      'createdAt': createdAt != null
          ? Timestamp.fromDate(createdAt!)
          : FieldValue.serverTimestamp(),
      'lastMessage': lastMessage?.toMap(),
      'lastMessageTime': lastMessageTime != null
          ? Timestamp.fromDate(lastMessageTime!)
          : null,
    };
  }
}
```

---

# 6. BLoC –î–õ–Ø –°–¢–í–û–†–ï–ù–ù–Ø –¢–ê –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø

## 6.1. CreateChatBloc

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω–æ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç—É.

### –ü–æ–¥—ñ—ó (Events)

```dart
abstract class CreateChatEvent extends Equatable {
  const CreateChatEvent();
  @override
  List<Object?> get props => [];
}

class CreateChatRequestedEvent extends CreateChatEvent {
  final String chatName;
  
  const CreateChatRequestedEvent(this.chatName);
  
  @override
  List<Object?> get props => [chatName];
}

class CreateChatResetEvent extends CreateChatEvent {
  const CreateChatResetEvent();
}
```

### –°—Ç–∞–Ω–∏ (States)

```dart
abstract class CreateChatState extends Equatable {
  const CreateChatState();
  @override
  List<Object?> get props => [];
}

class CreateChatInitialState extends CreateChatState {
  const CreateChatInitialState();
}

class CreateChatCreatingState extends CreateChatState {
  const CreateChatCreatingState();
}

class CreateChatSuccessState extends CreateChatState {
  final String chatId;
  final String chatName;
  
  const CreateChatSuccessState({
    required this.chatId,
    required this.chatName,
  });
  
  @override
  List<Object?> get props => [chatId, chatName];
}

class CreateChatErrorState extends CreateChatState {
  final String error;
  
  const CreateChatErrorState(this.error);
  
  @override
  List<Object?> get props => [error];
}
```

### BLoC —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

```dart
class CreateChatBloc extends Bloc<CreateChatEvent, CreateChatState> {
  final ChatsRepository _chatsRepository;

  CreateChatBloc({required ChatsRepository chatsRepository})
      : _chatsRepository = chatsRepository,
        super(const CreateChatInitialState()) {
    on<CreateChatRequestedEvent>(_onCreateChatRequested);
    on<CreateChatResetEvent>(_onCreateChatReset);
  }

  Future<void> _onCreateChatRequested(
    CreateChatRequestedEvent event,
    Emitter<CreateChatState> emit,
  ) async {
    emit(const CreateChatCreatingState());

    try {
      final chatId = await _chatsRepository.createChat(
        name: event.chatName,
      );

      emit(CreateChatSuccessState(
        chatId: chatId,
        chatName: event.chatName,
      ));
    } catch (e) {
      emit(CreateChatErrorState(e.toString()));
    }
  }

  void _onCreateChatReset(
    CreateChatResetEvent event,
    Emitter<CreateChatState> emit,
  ) {
    emit(const CreateChatInitialState());
  }
}
```

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ UI

```dart
BlocProvider(
  create: (_) => CreateChatBloc(
    chatsRepository: FirestoreChatsRepository(),
  ),
  child: BlocConsumer<CreateChatBloc, CreateChatState>(
    listener: (context, state) {
      if (state is CreateChatSuccessState) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('–ß–∞—Ç "${state.chatName}" —Å—Ç–≤–æ—Ä–µ–Ω–æ!')),
        );
        context.read<CreateChatBloc>().add(const CreateChatResetEvent());
        Navigator.pop(context); // –ó–∞–∫—Ä–∏—Ç–∏ –¥—ñ–∞–ª–æ–≥
      } else if (state is CreateChatErrorState) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('–ü–æ–º–∏–ª–∫–∞: ${state.error}')),
        );
      }
    },
    builder: (context, state) {
      if (state is CreateChatCreatingState) {
        return Center(child: CircularProgressIndicator());
      }
      
      return ElevatedButton(
        onPressed: () {
          context.read<CreateChatBloc>().add(
            CreateChatRequestedEvent('–ù–æ–≤–∏–π —á–∞—Ç'),
          );
        },
        child: Text('–°—Ç–≤–æ—Ä–∏—Ç–∏ —á–∞—Ç'),
      );
    },
  ),
)
```

## 6.2. UpdateChatBloc

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω–æ–º —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —á–∞—Ç—É.

```dart
class UpdateChatBloc extends Bloc<UpdateChatEvent, UpdateChatState> {
  final ChatsRepository _chatsRepository;

  UpdateChatBloc({required ChatsRepository chatsRepository})
      : _chatsRepository = chatsRepository,
        super(const UpdateChatInitialState()) {
    on<UpdateChatRequestedEvent>(_onUpdateChatRequested);
    on<UpdateChatResetEvent>(_onUpdateChatReset);
  }

  Future<void> _onUpdateChatRequested(
    UpdateChatRequestedEvent event,
    Emitter<UpdateChatState> emit,
  ) async {
    emit(const UpdateChatUpdatingState());

    try {
      await _chatsRepository.updateChat(
        chatId: event.chatId,
        name: event.chatName,
      );

      emit(UpdateChatSuccessState(chatId: event.chatId));
    } catch (e) {
      emit(UpdateChatErrorState(e.toString()));
    }
  }

  void _onUpdateChatReset(
    UpdateChatResetEvent event,
    Emitter<UpdateChatState> emit,
  ) {
    emit(const UpdateChatInitialState());
  }
}
```

---

# 7. –ü–†–ê–í–ò–õ–ê –ë–ï–ó–ü–ï–ö–ò FIRESTORE

## 7.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // –ü—Ä–∞–≤–∏–ª–∞ —Ç—É—Ç
  }
}
```

## 7.2. –û—Å–Ω–æ–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∏

- `allow read` - –¥–æ–∑–≤–æ–ª–∏—Ç–∏ —á–∏—Ç–∞–Ω–Ω—è
- `allow write` - –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∑–∞–ø–∏—Å (create, update, delete)
- `allow create` - –¥–æ–∑–≤–æ–ª–∏—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
- `allow update` - –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
- `allow delete` - –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è

## 7.3. –ó–º—ñ–Ω–Ω—ñ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—ó

```javascript
// –ó–º—ñ–Ω–Ω—ñ
request.auth        // –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
request.resource    // –î–∞–Ω—ñ, —è–∫—ñ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –∑–∞–ø–∏—Å–∞—Ç–∏
resource            // –Ü—Å–Ω—É—é—á—ñ –¥–∞–Ω—ñ –≤ –¥–æ–∫—É–º–µ–Ω—Ç—ñ
resource.data       // –î–∞–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∞

// –§—É–Ω–∫—Ü—ñ—ó
function isAuthenticated() {
  return request.auth != null;
}

function isOwner(userId) {
  return isAuthenticated() && request.auth.uid == userId;
}
```

## 7.4. –ü—Ä–∏–∫–ª–∞–¥–∏ –ø—Ä–∞–≤–∏–ª –¥–ª—è –ø—Ä–æ—î–∫—Ç—É

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Chat Rooms: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ –º–æ–∂—É—Ç—å —á–∏—Ç–∞—Ç–∏, –≤–ª–∞—Å–Ω–∏–∫ –º–æ–∂–µ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏
    match /chat_rooms/{chatRoomId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null
        && request.resource.data.createdBy == request.auth.uid;
      allow update: if request.auth != null
        && resource.data.createdBy == request.auth.uid;
      allow delete: if request.auth != null
        && resource.data.createdBy == request.auth.uid;
      
      // Messages: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ –º–æ–∂—É—Ç—å —á–∏—Ç–∞—Ç–∏, –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫ –º–æ–∂–µ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏
      match /messages/{messageId} {
        allow read: if request.auth != null;
        allow create: if request.auth != null
          && request.resource.data.senderId == request.auth.uid;
        allow update: if request.auth != null
          && resource.data.senderId == request.auth.uid;
        allow delete: if request.auth != null
          && resource.data.senderId == request.auth.uid;
      }
    }
    
    // Saved Messages: –¢—ñ–ª—å–∫–∏ –≤–ª–∞—Å–Ω–∏–∫
    match /saved_messages/{savedMessageId} {
      allow read: if request.auth != null
        && resource.data.userId == request.auth.uid;
      allow create: if request.auth != null
        && request.resource.data.userId == request.auth.uid;
      allow update: if false; // –ù–µ –¥–æ–∑–≤–æ–ª—è—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
      allow delete: if request.auth != null
        && resource.data.userId == request.auth.uid;
    }
  }
}
```

---

# 8. –õ–ê–ë–û–†–ê–¢–û–†–ù–ê –†–û–ë–û–¢–ê ‚Ññ6

## 8.1. –ó–∞–≤–¥–∞–Ω–Ω—è

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Firestore Database —Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ–π ‚úÖ

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—ó –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–∏—Ö –∑ Lab #2
2. –î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—ó –∑ –æ–ø–∏—Å–æ–º –ø–æ–ª—ñ–≤
3. –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—ñ–¥–∫–æ–ª–µ–∫—Ü—ñ—ó –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –≤ `FIRESTORE_COLLECTIONS.md`

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤–∏–ª –¥–æ—Å—Ç—É–ø—É ‚úÖ

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª `firestore.rules`
2. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–æ–∂–Ω–æ—ó –∫–æ–ª–µ–∫—Ü—ñ—ó
3. –î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø—É

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –§–∞–π–ª `firestore.rules` –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –±–µ–∑–ø–µ–∫–∏

### –ó–∞–≤–¥–∞–Ω–Ω—è 3: –†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –∫–æ–ª–µ–∫—Ü—ñ—è–º–∏ ‚úÖ

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤
2. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó —á–µ—Ä–µ–∑ Firestore
3. –°—Ç–≤–æ—Ä–∏—Ç–∏ –º–æ–¥–µ–ª—ñ –¥–∞–Ω–∏—Ö –∑ –º–µ—Ç–æ–¥–∞–º–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `ChatsRepository`
- `MessagesRepository`
- `SavedMessagesRepository`
- –ú–æ–¥–µ–ª—ñ: `ChatModel`, `MessageModel`, `SavedMessageModel`

### –ó–∞–≤–¥–∞–Ω–Ω—è 4: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö ‚úÖ

1. –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –≤ —ñ—Å–Ω—É—é—á–∏–π BLoC
2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—ñ–≤
3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Stream –¥–ª—è real-time –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–Ω–æ–≤–ª–µ–Ω–∏–π `ChatsBloc` –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤

### –ó–∞–≤–¥–∞–Ω–Ω—è 5: BLoC –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è ‚úÖ

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ `CreateChatBloc` –∑ –ø–æ–¥—ñ—è–º–∏ —Ç–∞ —Å—Ç–∞–Ω–∞–º–∏
2. –°—Ç–≤–æ—Ä–∏—Ç–∏ `UpdateChatBloc` –∑ –ø–æ–¥—ñ—è–º–∏ —Ç–∞ —Å—Ç–∞–Ω–∞–º–∏
3. –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –≤ UI

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `CreateChatBloc` - –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —á–∞—Ç—ñ–≤
- `UpdateChatBloc` - –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —á–∞—Ç—ñ–≤

### –ó–∞–≤–¥–∞–Ω–Ω—è 6: Firebase Storage (–Ω–µ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ) ‚ö™

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

### –ó–∞–≤–¥–∞–Ω–Ω—è 7: REST API (–Ω–µ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ) ‚ö™

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ REST API

## 8.2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤ –ø—Ä–æ—î–∫—Ç—É

```
lib/
‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îî‚îÄ‚îÄ chats/
‚îÇ       ‚îú‚îÄ‚îÄ models/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ chat_model.dart
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ message_model.dart
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ saved_message_model.dart
‚îÇ       ‚îú‚îÄ‚îÄ repositories/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ chats_repository.dart
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ messages_repository.dart
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ saved_messages_repository.dart
‚îÇ       ‚îî‚îÄ‚îÄ bloc/
‚îÇ           ‚îú‚îÄ‚îÄ chats_bloc.dart
‚îÇ           ‚îú‚îÄ‚îÄ create_chat_bloc.dart
‚îÇ           ‚îî‚îÄ‚îÄ update_chat_bloc.dart
‚îî‚îÄ‚îÄ core/
    ‚îî‚îÄ‚îÄ auth_repository.dart

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:
‚îú‚îÄ‚îÄ FIRESTORE_COLLECTIONS.md
‚îú‚îÄ‚îÄ firestore.rules
‚îú‚îÄ‚îÄ REPOSITORIES_DOCUMENTATION.md
‚îú‚îÄ‚îÄ FIREBASE_THEORY.md
‚îî‚îÄ‚îÄ LAB6_IMPLEMENTATION.md
```

## 8.3. –û—Å–Ω–æ–≤–Ω—ñ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è

‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—É —Å–∏—Å—Ç–µ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤  
‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ø–∞—Ç—Ç–µ—Ä–Ω Repository –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—ó –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö  
‚úÖ –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –∑ BLoC –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω–æ–º  
‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ BLoC –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —á–∞—Ç—ñ–≤  
‚úÖ –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–ø–µ–∫–∏ Firestore  
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–æ–≤–∞–Ω–æ –≤—Å—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó —Ç–∞ —ó—Ö –ø–æ–ª—è  
‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é  

---

# üìù –ü–†–ê–ö–¢–ò–ß–ù–Ü –ü–†–ò–ö–õ–ê–î–ò

## –ü—Ä–∏–∫–ª–∞–¥ 1: –ü–æ–≤–Ω–∏–π —Ü–∏–∫–ª —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —á–∞—Ç—É

```dart
// 1. UI - –ö–Ω–æ–ø–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
BlocProvider(
  create: (_) => CreateChatBloc(
    chatsRepository: FirestoreChatsRepository(),
  ),
  child: BlocConsumer<CreateChatBloc, CreateChatState>(
    listener: (context, state) {
      if (state is CreateChatSuccessState) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('–ß–∞—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ!')),
        );
        context.read<CreateChatBloc>().add(const CreateChatResetEvent());
        Navigator.pop(context);
      }
    },
    builder: (context, state) {
      return ElevatedButton(
        onPressed: state is CreateChatCreatingState
            ? null
            : () {
                context.read<CreateChatBloc>().add(
                  CreateChatRequestedEvent('–ù–æ–≤–∏–π —á–∞—Ç'),
                );
              },
        child: state is CreateChatCreatingState
            ? CircularProgressIndicator()
            : Text('–°—Ç–≤–æ—Ä–∏—Ç–∏'),
      );
    },
  ),
)

// 2. BLoC –æ–±—Ä–æ–±–ª—è—î –ø–æ–¥—ñ—é
CreateChatBloc ‚Üí CreateChatRequestedEvent ‚Üí _onCreateChatRequested

// 3. Repository —Å—Ç–≤–æ—Ä—é—î —á–∞—Ç
ChatsRepository.createChat() ‚Üí Firestore.add()

// 4. BLoC –µ–º—ñ—Ç—É—î —Å—Ç–∞–Ω
CreateChatSuccessState ‚Üí UI –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è
```

## –ü—Ä–∏–∫–ª–∞–¥ 2: Real-time —Å–ø–∏—Å–æ–∫ —á–∞—Ç—ñ–≤

```dart
// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Stream –∑ Repository
StreamBuilder<List<ChatModel>>(
  stream: FirestoreChatsRepository().getChatsStream(),
  builder: (context, snapshot) {
    if (snapshot.connectionState == ConnectionState.waiting) {
      return CircularProgressIndicator();
    }
    
    if (snapshot.hasError) {
      return Text('–ü–æ–º–∏–ª–∫–∞: ${snapshot.error}');
    }
    
    final chats = snapshot.data ?? [];
    return ListView.builder(
      itemCount: chats.length,
      itemBuilder: (context, index) {
        final chat = chats[index];
        return ChatListItem(chat: chat);
      },
    );
  },
)
```

## –ü—Ä–∏–∫–ª–∞–¥ 3: –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º lastMessage

```dart
Future<void> sendMessage(String chatId, String text) async {
  final user = FirebaseAuth.instance.currentUser;
  if (user == null) return;

  // 1. –î–æ–¥–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
  await FirebaseFirestore.instance
      .collection('chat_rooms')
      .doc(chatId)
      .collection('messages')
      .add({
        'text': text,
        'sender': user.email,
        'senderId': user.uid,
        'timestamp': FieldValue.serverTimestamp(),
      });

  // 2. –û–Ω–æ–≤–∏—Ç–∏ lastMessage –≤ —á–∞—Ç—ñ
  await FirebaseFirestore.instance
      .collection('chat_rooms')
      .doc(chatId)
      .update({
        'lastMessage': {
          'text': text,
          'sender': user.email,
        },
        'lastMessageTime': FieldValue.serverTimestamp(),
      });
}
```

---

# ‚úÖ –®–í–ò–î–ö–ê –î–û–í–Ü–î–ö–ê

## –ö–ª—é—á–æ–≤—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó:

1. **Firebase Core** - —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
2. **Firebase Auth** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
3. **Cloud Firestore** - –±–∞–∑–∞ –¥–∞–Ω–∏—Ö real-time
4. **StreamBuilder** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI
5. **Repository Pattern** - –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö
6. **BLoC Pattern** - –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω–æ–º
7. **Security Rules** - –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–ø–µ–∫–∏ Firestore

## –ù–∞–π–≤–∞–∂–ª–∏–≤—ñ—à—ñ –≤—ñ–¥–∂–µ—Ç–∏:

1. **StreamBuilder** - –¥–ª—è real-time –¥–∞–Ω–∏—Ö
2. **ListView.builder** - –¥–ª—è —Å–ø–∏—Å–∫—ñ–≤
3. **TextField** - –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è
4. **Card** - –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
5. **Scaffold** - –±–∞–∑–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –µ–∫—Ä–∞–Ω—É
6. **BlocBuilder** / **BlocConsumer** - –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ BLoC

## –ù–∞–π–≤–∞–∂–ª–∏–≤—ñ—à—ñ –º–µ—Ç–æ–¥–∏ Firestore:

- `get()` - –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–µ —á–∏—Ç–∞–Ω–Ω—è
- `snapshots()` - real-time –ø–æ—Ç—ñ–∫
- `add()` - –¥–æ–¥–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç
- `set()` - –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏/–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç
- `update()` - –æ–Ω–æ–≤–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç
- `delete()` - –≤–∏–¥–∞–ª–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç
- `orderBy()` - —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
- `where()` - —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
- `limit()` - –æ–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ

---

**–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è:** 2025  
**–í–µ—Ä—Å—ñ—è:** 1.0  
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ü–æ–≤–Ω–∞ —Ç–µ–æ—Ä—ñ—è –¥–ª—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–æ –∑–∞—Ö–∏—Å—Ç—É –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ ‚Ññ6

